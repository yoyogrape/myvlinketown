<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>网络支持</title>
			<meta name="viewport" content="width=device-width,initial-scale=0.4,minimum-scale=0.4,maximum-scale=0.4,user-scalable=no" />

		<link href="../css/robot-mainlinkpage-trouble.css" rel="stylesheet" />

		<script src="../js/jquery-1.11.3.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/url.properties.js"></script>
        <style type="text/css">
        	.mui-toast-container {bottom: 50% !important;}
        </style>
	</head>

	<body>
		<div class="mainlink-trouble-title">
			<img src="../images/sub-showannouncement-bluearrows.png" id="btn_goback" />
			<span>网络支持</span>
		</div>


		<div class="mainlink-trouble-body">
			<!-- ------报障标题开始------ -->
			<div class="trouble-body-title">
				<div class="title-left-submit title-bluebur">
					<span>提交报障</span>
				</div>
				<div class="title-right-look">
					<span>查看报障</span>
				</div>
			</div>
			<div class="body-title-bottomline"></div>
			<!-- ------报障标题结束------ -->

			<!-- ==========提交报障页面开始========== -->
			<div class="trouble-subpage-submittrouble" style="display: ;">
				<!-- ------报障表单开始------ -->
				<div class="trouble-body-form">
					<table>
						<tr>
							<td><span>报障标题:</span></td>
							<td><input type="text" name="" id="troubleTitle" placeholder="请输入标题" /></td>
						</tr>
						<tr height="60px">
						</tr>
						<tr>
							<td><span>手机号码:</span></td>
							<td><input type="text" name="" id="troubleTelephonNum" placeholder="请输入正确的手机号码" /></td>
						</tr>
						<tr height="60px">
						</tr>
						<tr>
							<td><span>故障类型:</span></td>
							<td><input type="text" name="" id="troubleType" placeholder="请选择故障类型" readonly="readonly" /></td>
							<div class="trouble-type-list" style="display: none;">
								<ul>
									<li>
										<span id="NETWORK_SERVICE">网络故障</span>
									</li>
									<li>
										<span id="SUPPORT_SERVICE">技术支持</span>
									</li>
									<li>
										<span id="SYSTEM_SERVICE">系统故障</span>
									</li>
									<li>
										<span id="BUSINESS_SERVICE">业务申请</span>
									</li>
								</ul>
							</div>
						</tr>
						<tr height="60px">
						</tr>
						<tr>
							<td><span>报障内容:</span></td>
							<td><textarea id="troubleContent" rows="4" cols="80"></textarea></td>
						</tr>
					</table>
				</div>

				<!-- ------报障表单结束------ -->

				<!-- ------提交按钮开始------ -->
				<div class="trouble-body-submit" id="btn_submit">
					<span>提交</span>
				</div>
				
				<div id="wifiHelp">无线登录<span></span></div>
				<!-- ------提交按钮结束------ -->
			</div>
			<!-- ==========提交报障页面结束========== -->

			<!-- ==========查看报障页面开始========== -->
			<div class="trouble-subpage-looktrouble" style="display: none;">
				<div class="looktrouble-body">
					<!-- ------报障具体内容开始------ -->
					<!--<div class="looktrouble-item">
						<div style="height: 60px;"></div>
						<div class="looktrouble-item-text">
							<div class="item-text-contect">
								<span>一楼展厅A站位网络不通，无法上网，请工作人员尽快处理</span>
							</div>
							<div style="height: 35px;"></div>

							<div class="item-text-time">
								<span>2018-07-09  16:43</span>
							</div>
						</div>
						<div class="looktrouble-item-state" style="color: #1B82D1;">
							<span>已完成</span>
						</div>
					</div>
					<div class="item-bottomline"></div>
					<div class="looktrouble-item">
						<div style="height: 60px;"></div>
						<div class="looktrouble-item-text">
							<div class="item-text-contect">
								<span>一楼展厅A站位网络不通，无法上网，请工作人员尽快处理</span>
							</div>
							<div style="height: 35px;">

							</div>
							<div class="item-text-time">
								<span>2018-07-09  16:43</span>
							</div>
						</div>
						<div class="looktrouble-item-state" style="color: #1B82D1;">
							<span>已完成</span>
						</div>
					</div>
					<div class="item-bottomline"></div>
					<div class="looktrouble-item">
						<div style="height: 60px;"></div>
						<div class="looktrouble-item-text">
							<div class="item-text-contect">
								<span>一楼展厅A站位网络不通，无法上网，请工作人员尽快处理</span>
							</div>
							<div style="height: 35px;">

							</div>
							<div class="item-text-time">
								<span>2018-07-09  16:43</span>
							</div>
						</div>
						<div class="looktrouble-item-state" style="color: #1B82D1;">
							<span>已完成</span>
						</div>
					</div>
					<div class="item-bottomline"></div>
					<div class="looktrouble-item">
						<div style="height: 60px;"></div>
						<div class="looktrouble-item-text">
							<div class="item-text-contect">
								<span>一楼展厅A站位网络不通，无法上网，请工作人员尽快处理</span>
							</div>
							<div style="height: 35px;">

							</div>
							<div class="item-text-time">
								<span>2018-07-09  16:43</span>
							</div>
						</div>
						<div class="looktrouble-item-state" style="color: #1B82D1;">
							<span>已完成</span>
						</div>
					</div>
					<div class="item-bottomline"></div>-->
					<!--   ----item-----   -->
					<!-- ------报障具体内容结束------ -->
				</div>
			</div>
			<!-- ==========查看报障页面开始========== -->
		</div>

	</body>

	<script type="text/javascript">
			mui.init(); //初始化mui
			//返回主页
			mui("#btn_goback")[0].addEventListener("tap", function() {
				mui.back();
			});
			 var wifiHtml;
			 var curWebView = null;
			 
	        mui.plusReady(function(){
	        	curWebView = plus.webview.currentWebview();
	        	window.addEventListener("toast",function(event){
	        		  plus.nativeUI.toast(event.detail.message,{
	        		  	verticalAlign:"top"
	        		  });
	        	})
               
	        		 wifiHtml=  mui.preload({
							   	url:"wifi.html",
							   	id:"wifi"
							   })
	        })
		   	mui("#wifiHelp")[0].addEventListener("tap", function() {
		   		console.log("okk")
				if(wifiHtml){
					wifiHtml.show("slide-in-right",300,false);
				}
			});
	</script>
     <script>
     	 var trouble = {
     	 		flag:true,
     	 	
     	 	init:function(){

     	 		this.initForm();
     	 		this.bindEvent();
     	 	},
     	 	initForm:function(){
     	 		
		

		
			//-------监听点击选择故障类型-------
		

     	 	},
     
     	 	commitTrouble:function (troubleObj) {	//将问题提交服务器
     	 		
				mui.ajax({
					type: "post",
					url: URLS.commitTrouble + "?jsoncallback=?",
					async: true,
					data: troubleObj,
					dataType: "jsonp",
					contentType: "application/json;charset=utf-8",
					jsonp: "jsoncallback",
					headers: {
						"Accept": "*/*"
					},
					timeout: 5000,
					success: function(data) {
						data = JSON.parse(data);
						if(data.code == 200) {
						mui.fire(curWebView,"toast",{message:"提交报障成功"})

						}
					},
					
					complete:function(){
						setTimeout(function(){
							trouble.flag = true;
						},3000)
					},
					error: function(xhr, type, errorThrown) {
					mui.fire(curWebView,"toast",{message:"提交报障失败，请稍后再试"})
					}

				});
			},
			
			lookTrouble:function () {//----------查看报障信息----------
				var serviceObj = {
					condition: {
					
					},
					order: "desc",
					rowCount: 10,
					sort: "createTime",
					startRow: 0,
					totalRecord: 0
				};

				mui.ajax({
					type: "post",
					url: URLS.getTroubleList + "?jsoncallback=?",
					async: true,
					data: JSON.stringify(serviceObj),
					dataType: "jsonp",
					contentType: "application/json;charset=utf-8",
					jsonp: "jsoncallback",
					headers: {
						"Accept": "*/*"
					},
					timeout: 6000,
					success: function(data) {

						data = JSON.parse(data);
						trouble.setTroubleList(data);
					},
					error: function(xhr, type, errorThrown) {
						mui.fire(curWebView,"toast",{message:errorThrown})
					}

				});

			},
            setTroubleList :function (data) {	//---生成报障列表---

				var troubleListHtml = '';
				for(var i = 0; i < data.data.length; i++) {
					var troubleItem = data.data[i];

					var createTime = troubleItem.createTime;
					createTime = createTime.substring(0, createTime.indexOf('.000')).replace('T', ' ');
					var state_str = '';
					var state = troubleItem.state;
					if(state == 0) {
						state_str = '未处理';
					} else if(state == 1) {
						state_str = '处理中';
					} else if(state == 2) {
						state_str = '已完成';
					}
					var troubleHtml = '<div class="looktrouble-item"><div style="height: 60px;"></div><div class="looktrouble-item-text"><div class="item-text-contect"><span>' + troubleItem.content + '</span></div><div style="height: 35px;"></div><div class="item-text-time"><span>' + createTime + '</span></div></div><div class="looktrouble-item-state"style="color: #1B82D1;"><span>' + state_str + '</span></div></div><div class="item-bottomline"></div>';

					troubleListHtml += troubleHtml;

				}

				$('.looktrouble-body').empty().append(troubleListHtml);
			},
     	 	bindEvent:function(){
     	 			mui(".title-left-submit")[0].addEventListener("tap", function() {
				document.getElementsByClassName("title-bluebur")[0].classList.remove("title-bluebur");
				this.classList.add("title-bluebur");
				$(".trouble-subpage-looktrouble").attr("style", "display: none;");
				$(".trouble-subpage-submittrouble").attr("style", "display: ;");
			});
			mui(".title-right-look")[0].addEventListener("tap", function() {
				document.getElementsByClassName("title-bluebur")[0].classList.remove("title-bluebur");
				this.classList.add("title-bluebur");
				$(".trouble-subpage-submittrouble").attr("style", "display: none;");
				$(".trouble-subpage-looktrouble").attr("style", "display: ;");
				trouble.lookTrouble();
			});
			    	mui("#troubleType")[0].addEventListener("tap", function() {
				$(".trouble-type-list").attr("style", "display: block;");

			});

			mui(".trouble-type-list").on("tap", ".trouble-type-list ul li", function() {
				var troubleId = $(this).find('span').attr('id');
				var troubleType = $(this).find('span').text();

				$('#troubleType').val(troubleType);
				$('#troubleType').attr('name', troubleId);
				$(".trouble-type-list").attr("style", "display: none;");
			});
            
             var flag =  true;
			//-------提交报障信息-------
			mui("#btn_submit")[0].addEventListener("tap", function() {
				var troubleTitle = $('#troubleTitle').val();
				var troubleTelephonNum = $('#troubleTelephonNum').val();
				var troubleType = $('#troubleType').val();
				var troubleContent = $('#troubleContent').val();
				var troubleTypeId = $('#troubleType').attr('name');

				var troubleObj = {};
				troubleObj.content = troubleContent;
				troubleObj.phone = troubleTelephonNum;
				troubleObj.name = troubleTitle;
				troubleObj.typeName = troubleType;
				troubleObj.typeId = troubleTypeId;
				console.log(JSON.stringify(troubleObj))
				var reg =/^[1][3,4,5,7,8][0-9]{9}$/;
				if(troubleObj.content.length==0){
					mui.fire(curWebView,"toast",{message:"请输入报障内容！"});
					return;
				}else if(troubleObj.phone.length==0&&reg.test(troubleObj.phone)){
						mui.fire(curWebView,"toast",{message:"请输入正确的手机号"})
						return;
				}else if(troubleObj.name.length==0){
					mui.fire(curWebView,"toast",{message:"请输入标题"})
					return;
				}else if(troubleObj.typeName.length==0){
					mui.fire(curWebView,"toast",{message:"请选择报障类型"})
					return;
				}
               
                 if(trouble.flag){
                 	//将问题提交服务器
				trouble.commitTrouble(troubleObj);
			
				trouble.flag = false;
                 }else {
                 	mui.fire(curWebView,"toast",{message:"重复操作次数过多"})
                 }
				

			});
			
     	 	}
     	 }
     	 
     	 
     	 window.addEventListener("trouble",function(){
     	 	trouble.init();
     	 })
     </script>
</html>